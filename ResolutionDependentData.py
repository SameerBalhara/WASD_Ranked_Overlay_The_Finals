import cv2
import os
from sklearn.ensemble import RandomForestClassifier

#preloads all required data
class Resolution():

    absPxls = None

    refImgDict_cvtd_to_Numpy = None
    maxHammingDistance = None

    #requires implementation below
    color_clf = None

    initialized = False

    distanceFromRight, distanceFromBottom = 800, 1800
    startXOffsetFromRight, startYOffsetFromBottom = 800, 1225
    boxW, boxH = 75, 75
    spacingFactor = 7
    fontSize = 14
    boxFontSize = 22

    @classmethod
    def init(cls, resolution):
        if cls.initialized:
            return
        cls._cvtRefImgToNumpy(resolution)
        cls._loadAbsPxls(resolution)
        cls._train_colors()
        cls.initialized = True

    @classmethod
    def _cvtRefImgToNumpy(cls, resolution):
        refImgDict_cvtd_to_Numpy = {}
        if resolution == (3840, 2160):
            for filename in os.listdir("AllCharactersBinarized4K"):
                filepath = "AllCharactersBinarized4K/" + filename
                refImgDict_cvtd_to_Numpy[filename[:2]] = cv2.imread(filepath, cv2.IMREAD_GRAYSCALE)
            cls.maxHammingDistance = 81 ** 2
        elif resolution == (2560, 1440):
            for filename in os.listdir("AllCharactersBinarized2K"):
                filepath = "AllCharactersBinarized2K/" + filename
                refImgDict_cvtd_to_Numpy[filename[:2]] = cv2.imread(filepath, cv2.IMREAD_GRAYSCALE)
            cls.maxHammingDistance = 53 ** 2
        elif resolution == (1920, 1080):
            for filename in os.listdir("AllCharactersBinarized1K"):
                filepath = "AllCharactersBinarized1K/" + filename
                refImgDict_cvtd_to_Numpy[filename[:2]] = cv2.imread(filepath, cv2.IMREAD_GRAYSCALE)
            cls.maxHammingDistance = 40 ** 2
        else:
            print("Invalid Resolution Provided")
            return
        cls.refImgDict_cvtd_to_Numpy = refImgDict_cvtd_to_Numpy

    @classmethod
    def _loadAbsPxls(cls, resolution):
        absPxls = []
        if resolution == (3840, 2160):
            rlvPxls = [((0.13725, 0.3965), (0.1585, 0.434)), ((0.43725, 0.3965), (0.4585, 0.434)),
                                       ((0.46025, 0.3965), (0.4815, 0.434)), ((0.48325, 0.3965), (0.50425, 0.434)),
                                       ((0.13725, 0.43725), (0.1585, 0.47475)), ((0.43725, 0.43725), (0.4585, 0.47475)),
                                       ((0.46025, 0.43725), (0.4815, 0.47475)),
                                       ((0.48325, 0.43725), (0.50425, 0.47475)), ((0.13725, 0.4775), (0.1585, 0.515)),
                                       ((0.43725, 0.4775), (0.4585, 0.515)), ((0.46025, 0.4775), (0.4815, 0.515)),
                                       ((0.48325, 0.4775), (0.50425, 0.515)),
                       ((0.13725, 0.53), (0.1585, 0.5675)), ((0.43725, 0.53), (0.4585, 0.5675)),
                                       ((0.46025, 0.53), (0.4815, 0.5675)), ((0.48325, 0.53), (0.50425, 0.5675)),
                                       ((0.13725, 0.57075), (0.1585, 0.60825)), ((0.43725, 0.57075), (0.4585, 0.60825)),
                                       ((0.46025, 0.57075), (0.4815, 0.60825)),
                                       ((0.48325, 0.57075), (0.50425, 0.60825)), ((0.13725, 0.611), (0.1585, 0.6485)),
                                       ((0.43725, 0.611), (0.4585, 0.6485)), ((0.46025, 0.611), (0.4815, 0.6485)),
                                       ((0.48325, 0.611), (0.50425, 0.6485)),
                       ((0.13725, 0.663), (0.1585, 0.7005)), ((0.43725, 0.663), (0.4585, 0.7005)),
                                       ((0.46025, 0.663), (0.4815, 0.7005)), ((0.48325, 0.663), (0.50425, 0.7005)),
                                       ((0.13725, 0.70375), (0.1585, 0.74125)), ((0.43725, 0.70375), (0.4585, 0.74125)),
                                       ((0.46025, 0.70375), (0.4815, 0.74125)),
                                       ((0.48325, 0.70375), (0.50425, 0.74125)), ((0.13725, 0.744), (0.1585, 0.7815)),
                                       ((0.43725, 0.744), (0.4585, 0.7815)), ((0.46025, 0.744), (0.4815, 0.7815)),
                                       ((0.48325, 0.744), (0.50425, 0.7815))]
        elif resolution == (2560, 1440):
            rlvPxls = [((0.1375, 0.3975), (0.1585, 0.4345)), ((0.4375, 0.3975), (0.4585, 0.4345)),
                           ((0.46075, 0.3975), (0.4815, 0.4345)), ((0.4835, 0.3975), (0.50425, 0.4345)),
                           ((0.1375, 0.4385), (0.1585, 0.475)), ((0.4375, 0.4385), (0.4585, 0.475)),
                           ((0.46075, 0.4385), (0.4815, 0.475)), ((0.4835, 0.4385), (0.50425, 0.475)),
                           ((0.1375, 0.4785), (0.1585, 0.5155)), ((0.4375, 0.4785), (0.4585, 0.5155)),
                           ((0.46075, 0.4785), (0.4815, 0.5155)), ((0.4835, 0.4785), (0.50425, 0.5155)),
                       ((0.1375, 0.531), (0.1585, 0.5675)), ((0.4375, 0.531), (0.4585, 0.5675)),
                           ((0.46075, 0.531), (0.4815, 0.5675)), ((0.4835, 0.531), (0.50425, 0.5675)),
                           ((0.1375, 0.5722), (0.1585, 0.60875)), ((0.4375, 0.5722), (0.4585, 0.60875)),
                           ((0.46075, 0.5722), (0.4815, 0.60875)), ((0.4835, 0.5722), (0.50425, 0.60875)),
                           ((0.1375, 0.61185), (0.1585, 0.64875)), ((0.4375, 0.61185), (0.4585, 0.64875)),
                           ((0.46075, 0.61185), (0.4815, 0.64875)), ((0.4835, 0.61185), (0.50425, 0.64875)),
                       ((0.1375, 0.664), (0.1585, 0.701)), ((0.4375, 0.664), (0.4585, 0.701)),
                           ((0.46075, 0.664), (0.4815, 0.701)), ((0.4835, 0.664), (0.50425, 0.701)),
                           ((0.1375, 0.705), (0.1585, 0.74175)), ((0.4375, 0.7049), (0.4585, 0.74175)),
                           ((0.46075, 0.705), (0.4815, 0.74175)), ((0.4835, 0.7049), (0.50425, 0.74175)),
                           ((0.1375, 0.74575), (0.1585, 0.782)), ((0.4375, 0.74575), (0.4585, 0.782)),
                           ((0.46075, 0.74575), (0.4815, 0.782)), ((0.4835, 0.74575), (0.50425, 0.782))]
        elif resolution == (1920, 1080):
            rlvPxls = [((0.1375, 0.3955), (0.1585, 0.4325)), ((0.4375, 0.3955), (0.4585, 0.4325)),
                           ((0.4605, 0.3955), (0.4815, 0.4325)), ((0.4835, 0.3955), (0.50425, 0.4325)),
                           ((0.1375, 0.437), (0.1585, 0.474)), ((0.4375, 0.437), (0.4585, 0.474)),
                           ((0.4605, 0.437), (0.4815, 0.474)), ((0.4835, 0.437), (0.50425, 0.474)),
                           ((0.1375, 0.4775), (0.1585, 0.51475)), ((0.4375, 0.4775), (0.4585, 0.51475)),
                           ((0.4605, 0.4775), (0.4815, 0.51475)), ((0.4835, 0.4775), (0.50425, 0.51475)),
                       ((0.1375, 0.5295), (0.1585, 0.5665)), ((0.4375, 0.5295), (0.4585, 0.5665)),
                           ((0.4605, 0.5295), (0.4815, 0.5665)), ((0.4835, 0.5295), (0.50425, 0.5665)),
                           ((0.1375, 0.57025), (0.1585, 0.60725)), ((0.4375, 0.57025), (0.4585, 0.60725)),
                           ((0.4605, 0.57025), (0.4815, 0.60725)), ((0.4835, 0.57025), (0.50425, 0.60725)),
                           ((0.1375, 0.611), (0.1585, 0.648)), ((0.4375, 0.611), (0.4585, 0.648)),
                           ((0.4605, 0.611), (0.4815, 0.648)), ((0.4835, 0.611), (0.50425, 0.648)),
                       ((0.1375, 0.6625), (0.1585, 0.69975)), ((0.4375, 0.6625), (0.4585, 0.69975)),
                           ((0.4605, 0.6625), (0.4815, 0.69975)), ((0.4835, 0.6625), (0.50425, 0.69975)),
                           ((0.1375, 0.7035), (0.1585, 0.74)), ((0.4375, 0.7035), (0.4585, 0.74)),
                           ((0.4605, 0.7035), (0.4815, 0.74)), ((0.4835, 0.7035), (0.50425, 0.74)),
                           ((0.1375, 0.744), (0.1585, 0.781)), ((0.4375, 0.744), (0.4585, 0.781)),
                           ((0.4605, 0.744), (0.4815, 0.781)), ((0.4835, 0.744), (0.50425, 0.781))]
        else:
            print("Invalid Resolution Provided")
            return

        width = resolution[0]
        height = resolution[1]
        for coords in rlvPxls:
            tl, br = coords[0], coords[1]
            x1, y1 = int(tl[0] * width), int(tl[1] * height)
            x2, y2 = int(br[0] * width), int(br[1] * height)
            absPxls.append(((x1, y1), (x2, y2)))

        cls.absPxls = absPxls

    @classmethod
    def _train_colors(cls):
        X_pink = [
            [232, 73, 185], [239, 70, 165], [246, 72, 183], [236, 70, 190], [238, 65, 188],
            [242, 61, 162], [246, 59, 183], [237, 56, 189], [244, 73, 181], [243, 64, 192],
            [240, 76, 183], [241, 61, 165], [247, 59, 171], [242, 55, 183], [234, 78, 179],
            [243, 68, 187], [248, 60, 164], [240, 62, 179], [235, 66, 185], [244, 70, 173],
            [246, 65, 181], [239, 56, 187], [243, 58, 166], [237, 61, 178], [245, 63, 170],
            [238, 55, 176], [249, 60, 185], [244, 70, 168], [241, 67, 182], [247, 59, 177],
            [235, 66, 180], [243, 69, 175], [238, 62, 186], [246, 60, 173], [236, 65, 172],
            [239, 68, 179], [241, 62, 184], [248, 71, 176], [237, 64, 168], [242, 59, 186],
            [245, 70, 169], [240, 63, 187], [236, 61, 165], [239, 74, 179], [242, 56, 181],
            [234, 68, 177], [241, 69, 180], [246, 62, 178], [237, 73, 173], [243, 66, 172]
        ]
        y_pink = ['Pink'] * 50
        X_purple = [
            [158, 76, 247], [136, 79, 229], [142, 65, 228], [147, 70, 244], [139, 67, 243],
            [140, 72, 231], [152, 74, 247], [141, 79, 234], [145, 66, 246], [156, 71, 236],
            [138, 77, 240], [146, 70, 239], [150, 75, 248], [142, 78, 232], [157, 72, 238],
            [144, 67, 241], [153, 70, 245], [140, 76, 230], [151, 73, 249], [139, 74, 236],
            [143, 77, 238], [147, 69, 233], [155, 72, 246], [144, 74, 242], [149, 70, 237],
            [135, 76, 241], [137, 67, 229], [159, 75, 245], [148, 68, 234], [140, 78, 230],
            [150, 71, 235], [138, 66, 247], [147, 79, 239], [143, 76, 243], [146, 68, 244],
            [141, 74, 236], [149, 70, 246], [155, 78, 240], [135, 68, 232], [148, 75, 247],
            [139, 69, 233], [151, 77, 241], [140, 73, 234], [145, 66, 243], [150, 74, 237],
            [143, 70, 240], [142, 77, 248], [136, 72, 230], [138, 75, 229], [153, 71, 244]
        ]
        y_purple = ['Purple'] * 50
        X_orange = [
            [252, 130, 18], [237, 125, 10], [246, 123, 12], [239, 116, 7], [243, 113, 5],
            [234, 114, 9], [247, 118, 6], [245, 115, 3], [250, 124, 8], [241, 119, 4],
            [235, 123, 11], [249, 117, 5], [243, 126, 14], [238, 120, 7], [244, 121, 6],
            [240, 115, 2], [236, 122, 10], [251, 118, 4], [239, 127, 12], [248, 116, 5],
            [242, 117, 6], [246, 121, 3], [245, 119, 7], [238, 114, 5], [244, 122, 9],
            [250, 129, 13], [247, 125, 15], [243, 116, 6], [237, 124, 11], [248, 120, 5],
            [249, 126, 8], [236, 119, 3], [244, 127, 7], [251, 119, 10], [240, 113, 4],
            [237, 116, 9], [246, 122, 5], [238, 117, 6], [239, 121, 7], [242, 128, 11],
            [245, 120, 5], [247, 119, 4], [250, 127, 12], [241, 118, 6], [243, 124, 10],
            [235, 115, 7], [238, 123, 8], [246, 118, 5], [248, 129, 13], [239, 115, 2]
        ]
        y_orange = ['Orange'] * 50
        X = X_pink + X_purple + X_orange
        y = y_pink + y_purple + y_orange

        cls.color_clf = RandomForestClassifier(n_estimators=100, max_depth=10, random_state=42)
        cls.color_clf.fit(X, y)

